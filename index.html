<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Line Chart</title>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://www.google.com/jsapi"></script>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="functions.js"></script>
    <script>

        //list of countries interested
        var countries = ['USA', 'UK', 'Sweden', 'Italy', 'South Korea', 'South Africa'];

        //Create 2D array, first layer: countries, second: deaths for each countries per day
        var allDeaths = new Array(countries.length);
        for(var i =0; i < allDeaths.length; i++){
            allDeaths[i] = new Array();
        }

        console.log('AllDeaths length: ' + allDeaths.length);

        var requestOptions = {
            method: 'GET',
            redirect: 'follow'
        };
        var baseUrl = 'https://api.covid19api.com';
        var dateStart = '2020-03-01';
        var dateEnd = '2020-07-18';

        //indicator to populate date array, only once (first iteration), set true after so subsequent population will ignore date.
        var isDateParsed = false;
        var dateArr = new Array();

        for(var a = 0; a < allDeaths.length; a++){
            var country = countries[a];
            var url = baseUrl + "/total/country/" + country + "?from=" + dateStart + "&to=" + dateEnd;
            //Get the json object based on parameters defined above
            var jsonObj = JSON.parse(Get(url));

            var deathArr = new Array();
            for(var i = 0; i < jsonObj.length; i++){
                var obj = jsonObj[i];
                allDeaths[a].push(obj.Deaths);

                if(!isDateParsed){
                    var date1 = obj.Date;
                    // date1 = date1.substring(0,10);
                    dateArr.push(date1);
                }
            }
            isDateParsed = true;
        }

        console.log(allDeaths);

        google.charts.load('current', {
            'packages': ['line']
        });
        google.charts.setOnLoadCallback(drawMyChart);

        // google.charts.load('current', {
        //     callback:drawMyChart()
        // })

        function drawMyChart() {
            var arr = countries.slice();
            arr.unshift('Day'); //add day to array, so country name matches exactly what was on the request

            var data = new google.visualization.DataTable();
            data.addColumn('date', arr[0]);
            for(var b = 1; b < arr.length; b++){
                data.addColumn('number', arr[b]);
            }

            for(var i = 0; i < allDeaths[0].length; i++){
                var row = new Array();
                row.push(new Date(dateArr[i]));
                for(var c = 0; c < allDeaths.length; c++){
                    row.push(allDeaths[c][i]);
                }
                data.addRows(new Array(row));
            }


            var options = {
                //colors: ['#e0440e', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
                // title: 'Death since ' + dateStart
                // chart: {
                //     title: 'Death since ' + dateStart,
                //
                // },
                chartArea: {
                    width: '90%'
                },
                height: 600,
                legend: {
                    position: 'bottom',
                    textStyle: {
                        color: 'black',
                        fontSize: 16
                    }
                },
                pointSize: 30,
                theme: 'material',
                title: 'Death since ' + dateStart,
                vAxis: {
                    viewWindow: {
                        min: 0
                    }
                },
                width: '100%'
            };

            var chart = new google.charts.Line(document.getElementById('linechart_material'));
            chart.draw(data, google.charts.Line.convertOptions(options));
            //chart.draw(data, options);
        }
        $(window).resize(function(){
            drawMyChart();
        });

    </script>

</head>

<body>

<div class="row">
    <div class="col-md-4 col-md-offset-4">
        <hr />
    </div>
    <div class="clearfix"></div>
    <div class="col-md-12">
        <div id="linechart_material" class="chart"></div>
    </div>
    <div class="col-md-6">
        <div id="chart_div2" class="chart"></div>
    </div>
</div>





<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</body>

</html>