<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Line Chart</title>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="functions.js"></script>
    <script>

        //list of countries interested
        var countries = ['USA', 'UK', 'Sweden', 'Italy', 'South Korea', 'South Africa'];

        //Create 2D array, first layer: countries, second: deaths for each countries per day
        var allDeaths = new Array(countries.length);
        for(var i =0; i < allDeaths.length; i++){
            allDeaths[i] = new Array();
        }

        console.log('AllDeaths length: ' + allDeaths.length);

        var requestOptions = {
            method: 'GET',
            redirect: 'follow'
        };
        var baseUrl = 'https://api.covid19api.com';
        var dateStart = '2020-03-01';
        var dateEnd = '2020-07-18';

        //indicator to populate date array, only once (first iteration), set true after so subsequent population will ignore date.
        var isDateParsed = false;
        var dateArr = new Array();

        for(var a = 0; a < allDeaths.length; a++){
            var country = countries[a];
            var url = baseUrl + "/total/country/" + country + "?from=" + dateStart + "&to=" + dateEnd;
            //Get the json object based on parameters defined above
            var jsonObj = JSON.parse(Get(url));

            var deathArr = new Array();
            for(var i = 0; i < jsonObj.length; i++){
                var obj = jsonObj[i];
                allDeaths[a].push(obj.Deaths);

                if(!isDateParsed){
                    var date1 = obj.Date;
                    // date1 = date1.substring(0,10);
                    dateArr.push(date1);
                }
            }
            isDateParsed = true;
        }

        console.log(allDeaths);

        google.charts.load('current', {
            'packages': ['line']
        });
        google.charts.setOnLoadCallback(drawMyChart);

        function drawMyChart() {
            var arr = countries.slice();
            arr.unshift('Day'); //add day to array, so country name matches exactly what was on the request

            var data = new google.visualization.DataTable();
            data.addColumn('date', arr[0]);
            for(var b = 1; b < arr.length; b++){
                data.addColumn('number', arr[b]);
            }

            for(var i = 0; i < allDeaths[0].length; i++){
                var row = new Array();
                row.push(new Date(dateArr[i]));
                for(var c = 0; c < allDeaths.length; c++){
                    row.push(allDeaths[c][i]);
                }
                data.addRows(new Array(row));
            }

            var options = {
                chart: {
                    title: 'Death since ' + dateStart,
                },
                width: 1000,
                height: 800
            };

            var chart = new google.charts.Line(document.getElementById('linechart_material'));
            chart.draw(data, google.charts.Line.convertOptions(options));
        }
    </script>

</head>

<body>
    <div id="linechart_material"></div>


</body>

</html>